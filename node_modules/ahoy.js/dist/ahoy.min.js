/*! Ahoy.js v0.4.3 | MIT License */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ahoy=e()}(this,(function(){"use strict";var t={set:function(t,e,n,i){var r="",o="";if(n){var a=new Date;a.setTime(a.getTime()+60*n*1e3),r="; expires="+a.toGMTString()}i&&(o="; domain="+i),document.cookie=t+"="+escape(e)+r+o+"; path=/; samesite=lax"},get:function(t){var e,n,i=t+"=",r=document.cookie.split(";");for(e=0;e<r.length;e++){for(n=r[e];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return unescape(n.substring(i.length,n.length))}return null}},e={urlPrefix:"",visitsUrl:"/ahoy/visits",eventsUrl:"/ahoy/events",page:null,platform:"Web",useBeacon:!0,startOnReady:!0,trackVisits:!0,cookies:!0,cookieDomain:null,headers:{},visitParams:{},withCredentials:!1,visitDuration:240,visitorDuration:1051200},n=window.ahoy||window.Ahoy||{};n.configure=function(t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n.configure(n);var i,r,o,a,s=window.jQuery||window.Zepto||window.$,c=!1,u=[],l="undefined"!=typeof JSON&&void 0!==JSON.stringify,f=[];function d(){return e.urlPrefix+e.eventsUrl}function h(){return(e.useBeacon||e.trackNow)&&(t=e.headers,0===Object.keys(t).length)&&l&&void 0!==window.navigator.sendBeacon&&!e.withCredentials;var t}function v(n,i,r){t.set(n,i,r,e.cookieDomain||e.domain)}function p(e){return t.get(e)}function g(e){t.set(e,"",-1)}function y(t){p("ahoy_debug")&&window.console.log(t)}function m(){for(var t;t=u.shift();)t();c=!0}function w(t,e){var n=t.matches||t.matchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||t.webkitMatchesSelector;return n?n.apply(t,[e])?t:t.parentElement?w(t.parentElement,e):null:(y("Unable to match"),null)}function k(t,e,n){document.addEventListener(t,(function(t){var i=w(t.target,e);if(i){var r=N(i,"data-ahoy-skip");if(null!==r&&"false"!==r)return;n.call(i,t)}}))}function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}function _(){e.cookies&&l&&v("ahoy_events",JSON.stringify(f),1)}function b(){var t=document.querySelector("meta[name=csrf-token]");return t&&t.content}function O(t){var e=b();e&&t.setRequestHeader("X-CSRF-Token",e)}function S(t,n,i){if(l)if(s&&s.ajax)s.ajax({type:"POST",url:t,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:O,success:i,headers:e.headers,xhrFields:{withCredentials:e.withCredentials}});else{var r=new XMLHttpRequest;for(var o in r.open("POST",t,!0),r.withCredentials=e.withCredentials,r.setRequestHeader("Content-Type","application/json"),e.headers)Object.prototype.hasOwnProperty.call(e.headers,o)&&r.setRequestHeader(o,e.headers[o]);r.onload=function(){200===r.status&&i()},O(r),r.send(JSON.stringify(n))}}function T(t){var n={events:[t]};return e.cookies&&(n.visit_token=t.visit_token,n.visitor_token=t.visitor_token),delete t.visit_token,delete t.visitor_token,n}function j(t){n.ready((function(){S(d(),T(t),(function(){for(var e=0;e<f.length;e++)if(f[e].id===t.id){f.splice(e,1);break}_()}))}))}function C(t){n.ready((function(){var e,n=T(t),i=(e=document.querySelector("meta[name=csrf-param]"))&&e.content,r=b();i&&r&&(n[i]=r),n.events_json=JSON.stringify(n.events),delete n.events,window.navigator.sendBeacon(d(),function(t){var e=new FormData;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.append(n,t[n]);return e}(n))}))}function P(){return e.page||window.location.pathname}function V(t){return t&&t.length>0?t:null}function M(){return function(t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&null===t[e]&&delete t[e];return t}({tag:this.tagName.toLowerCase(),id:V(this.id),class:V(this.className),page:P(),section:N(this,"data-section")})}function N(t,e){for(;t&&t!==document;t=t.parentNode)if(t.hasAttribute(e))return t.getAttribute(e);return null}function D(){if(c=!1,i=n.getVisitId(),r=n.getVisitorId(),o=p("ahoy_track"),!1===e.cookies||!1===e.trackVisits)y("Visit tracking disabled"),m();else if(i&&r&&!o)y("Active visit"),m();else if(i||v("ahoy_visit",i=x(),e.visitDuration),p("ahoy_visit")){y("Visit started"),r||v("ahoy_visitor",r=x(),e.visitorDuration);var t={visit_token:i,visitor_token:r,platform:e.platform,landing_page:window.location.href,screen_width:window.screen.width,screen_height:window.screen.height,js:!0};for(var a in document.referrer.length>0&&(t.referrer=document.referrer),e.visitParams)Object.prototype.hasOwnProperty.call(e.visitParams,a)&&(t[a]=e.visitParams[a]);y(t),S(e.urlPrefix+e.visitsUrl,t,(function(){g("ahoy_track"),m()}))}else y("Cookies disabled"),m()}n.ready=function(t){c?t():u.push(t)},n.getVisitId=n.getVisitToken=function(){return p("ahoy_visit")},n.getVisitorId=n.getVisitorToken=function(){return p("ahoy_visitor")},n.reset=function(){return g("ahoy_visit"),g("ahoy_visitor"),g("ahoy_events"),g("ahoy_track"),!0},n.debug=function(t){return!1===t?g("ahoy_debug"):v("ahoy_debug","t",525600),!0},n.track=function(t,i){var r={name:t,properties:i||{},time:(new Date).getTime()/1e3,id:x(),js:!0};return n.ready((function(){e.cookies&&!n.getVisitId()&&D(),n.ready((function(){y(r),r.visit_token=n.getVisitId(),r.visitor_token=n.getVisitorId(),h()?C(r):(f.push(r),_(),setTimeout((function(){j(r)}),1e3))}))})),!0},n.trackView=function(t){var e={url:window.location.href,title:document.title,page:P()};if(t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);n.track("$view",e)},n.trackClicks=function(t){if(void 0===t)throw new Error("Missing selector");k("click",t,(function(t){var e=M.call(this,t);e.text="input"===e.tag?this.value:(this.textContent||this.innerText||this.innerHTML).replace(/[\s\r\n]+/g," ").trim(),e.href=this.href,n.track("$click",e)}))},n.trackSubmits=function(t){if(void 0===t)throw new Error("Missing selector");k("submit",t,(function(t){var e=M.call(this,t);n.track("$submit",e)}))},n.trackChanges=function(t){if(y("trackChanges is deprecated and will be removed in 0.5.0"),void 0===t)throw new Error("Missing selector");k("change",t,(function(t){var e=M.call(this,t);n.track("$change",e)}))};try{f=JSON.parse(p("ahoy_events")||"[]")}catch(t){}for(var E=0;E<f.length;E++)j(f[E]);return n.start=function(){D(),n.start=function(){}},a=function(){e.startOnReady&&n.start()},"interactive"===document.readyState||"complete"===document.readyState?setTimeout(a,0):document.addEventListener("DOMContentLoaded",a),n}));
